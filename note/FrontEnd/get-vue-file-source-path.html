<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何获取 vue 单文件自身源码路径 | 📚 Better Note</title>
    <meta name="description" content="CNine的日常笔记">
    <script src="/static/av-min.js"></script>
  <script src="/static/valine.min.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.6a4224b2.css" as="style"><link rel="preload" href="/assets/js/app.f578ad0c.js" as="script"><link rel="preload" href="/assets/js/2.1da21283.js" as="script"><link rel="preload" href="/assets/js/20.4e1a83a3.js" as="script"><link rel="prefetch" href="/assets/js/10.07c5d395.js"><link rel="prefetch" href="/assets/js/11.27ea0d90.js"><link rel="prefetch" href="/assets/js/12.757a8118.js"><link rel="prefetch" href="/assets/js/13.607b8196.js"><link rel="prefetch" href="/assets/js/14.0ddacca7.js"><link rel="prefetch" href="/assets/js/15.2fccfa6e.js"><link rel="prefetch" href="/assets/js/16.88ce096e.js"><link rel="prefetch" href="/assets/js/17.4c8d68a9.js"><link rel="prefetch" href="/assets/js/18.49b79f21.js"><link rel="prefetch" href="/assets/js/19.a712f617.js"><link rel="prefetch" href="/assets/js/21.0f1ede70.js"><link rel="prefetch" href="/assets/js/22.f4cf1f8c.js"><link rel="prefetch" href="/assets/js/23.8717d2f0.js"><link rel="prefetch" href="/assets/js/24.68136e3c.js"><link rel="prefetch" href="/assets/js/25.d7ec0ff7.js"><link rel="prefetch" href="/assets/js/26.1659de14.js"><link rel="prefetch" href="/assets/js/27.06e13cf7.js"><link rel="prefetch" href="/assets/js/28.9a5d2b82.js"><link rel="prefetch" href="/assets/js/3.b547c54b.js"><link rel="prefetch" href="/assets/js/4.83a4ded6.js"><link rel="prefetch" href="/assets/js/5.5a0bbf23.js"><link rel="prefetch" href="/assets/js/6.9052f74f.js"><link rel="prefetch" href="/assets/js/7.f6a5ad06.js"><link rel="prefetch" href="/assets/js/8.6bf2c3fa.js"><link rel="prefetch" href="/assets/js/9.fdd054e1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a4224b2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">📚 Better Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">📗 笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/FrontEnd/" class="nav-link router-link-active">🦄 Web前端</a></li><li class="dropdown-item"><!----> <a href="/note/NodeJS/" class="nav-link">🐢 NodeJS</a></li><li class="dropdown-item"><!----> <a href="/note/Database/" class="nav-link">🐘 数据库</a></li><li class="dropdown-item"><!----> <a href="/note/Linux/" class="nav-link">🐧 Linux</a></li><li class="dropdown-item"><!----> <a href="/note/Explore/" class="nav-link">🚀 探索</a></li></ul></div></div><div class="nav-item"><a href="/star/" class="nav-link">👓 收藏集</a></div><div class="nav-item"><a href="/project/" class="nav-link">🌈 作品</a></div><div class="nav-item"><a href="/quick/" class="nav-link">⚡️ 速食记</a></div> <a href="https://github.com/Aysnine/better-note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">📗 笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/FrontEnd/" class="nav-link router-link-active">🦄 Web前端</a></li><li class="dropdown-item"><!----> <a href="/note/NodeJS/" class="nav-link">🐢 NodeJS</a></li><li class="dropdown-item"><!----> <a href="/note/Database/" class="nav-link">🐘 数据库</a></li><li class="dropdown-item"><!----> <a href="/note/Linux/" class="nav-link">🐧 Linux</a></li><li class="dropdown-item"><!----> <a href="/note/Explore/" class="nav-link">🚀 探索</a></li></ul></div></div><div class="nav-item"><a href="/star/" class="nav-link">👓 收藏集</a></div><div class="nav-item"><a href="/project/" class="nav-link">🌈 作品</a></div><div class="nav-item"><a href="/quick/" class="nav-link">⚡️ 速食记</a></div> <a href="https://github.com/Aysnine/better-note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>🦄 Web前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/FrontEnd/" class="sidebar-link">Web 前端</a></li><li><a href="/note/FrontEnd/elementui-tree-disabled.html" class="sidebar-link">ElementUI 之 Tree 组件切换全局 disabled</a></li><li><a href="/note/FrontEnd/get-vue-file-source-path.html" class="active sidebar-link">如何获取 vue 单文件自身源码路径</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/FrontEnd/get-vue-file-source-path.html#方案-1-：node-filename" class="sidebar-link">方案 1 ：node + __filename</a></li><li class="sidebar-sub-header"><a href="/note/FrontEnd/get-vue-file-source-path.html#方案-2-：vue-loader-exposefilename" class="sidebar-link">方案 2 ：vue-loader + exposeFilename</a></li><li class="sidebar-sub-header"><a href="/note/FrontEnd/get-vue-file-source-path.html#方案-3-：loader-custom-block" class="sidebar-link">方案 3 ：loader + Custom Block</a></li><li class="sidebar-sub-header"><a href="/note/FrontEnd/get-vue-file-source-path.html#相关仓库" class="sidebar-link">相关仓库</a></li><li class="sidebar-sub-header"><a href="/note/FrontEnd/get-vue-file-source-path.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/note/FrontEnd/mock-lose-cookies-dbg.html" class="sidebar-link">如何修复 MockJS 导致请求丢 Cookies 的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/FrontEnd/mock-lose-cookies-dbg.html#问题描述" class="sidebar-link">问题描述</a></li><li class="sidebar-sub-header"><a href="/note/FrontEnd/mock-lose-cookies-dbg.html#分析调试" class="sidebar-link">分析调试</a></li></ul></li><li><a href="/note/FrontEnd/webpack-source-self-path.html" class="sidebar-link">Webpack 下，源码文件获取自身路径</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何获取-vue-单文件自身源码路径"><a href="#如何获取-vue-单文件自身源码路径" aria-hidden="true" class="header-anchor">#</a> 如何获取 vue 单文件自身源码路径</h1> <p>这个问题要从一个想法说起。</p> <p><a href="https://github.com/d2-projects/d2-admin" target="_blank" rel="noopener noreferrer">D2Admin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个开源的，前端中后台集成方案，原先是基于 vue-cli2，大概是向 vue-cli3 过渡时，
作者老李，想在页面右下角加个 Toggle 点击，跳到当前页面源码对应的 github 页面。</p> <p>确实很实用的功能，D2Admin 的 Demo 页面太多了，想看某个页面的源码，对于不熟悉项目目录结构的新手很不友好。</p> <p>这些页面统一为 <code>.vue</code> 组件，那么转换一下：如何获取 vue 单文件自身源码路径？</p> <p>目前经历了三个方案，最终目标是把自身路径赋值到 <code>this.$options.__source</code> 上。目前方案 3 是最新的。</p> <h2 id="方案-1-：node-filename"><a href="#方案-1-：node-filename" aria-hidden="true" class="header-anchor">#</a> 方案 1 ：node + __filename</h2> <p>直接使用 node 中的 <code>__filename</code> 变量：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{ $options.__source }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>__source <span class="token operator">=</span> __filename
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>因为 webpack 编译时，会把源码文件在内部转为 node 模块，<code>.vue</code> 文件中的 script 内容也被转换了，
其中的 <code>__filename</code> 在编译时被运行，直接得到当前文件自身路径。</p> <p>使用这个变量还需要在 webpack 配置中启用 <code>node.__filename</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* vue.config.js */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">chainWebpack</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    config<span class="token punctuation">.</span>node
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'__dirname'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 同理</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'__filename'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="缺点"><a href="#缺点" aria-hidden="true" class="header-anchor">#</a> 缺点</h3> <ul><li>要在每个组件里手动赋值，还不能用 mixin</li> <li><code>__filename</code> 得到的路径在部分 <code>.vue</code> 文件下并不准确，路径可能还会带附带 querystring</li></ul> <p><em>一开始，坚强的老李用这个方式，给上百个组件手动挂上了路径，但总比手动写死每个路径要好</em></p> <h2 id="方案-2-：vue-loader-exposefilename"><a href="#方案-2-：vue-loader-exposefilename" aria-hidden="true" class="header-anchor">#</a> 方案 2 ：vue-loader + exposeFilename</h2> <p>在 loader 层面，其实 <code>vue-loader</code> 提供了一个 <code>exposeFilename</code> 选项，只要启用，
就会给每个 <code>.vue</code> 组件带上 <code>this.$options.__file</code>，上面有准确的路径。</p> <p>这样只需要改 loader 配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* vue.config.js */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">chainWebpack</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'vue-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'vue-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          options<span class="token punctuation">.</span>exposeFilename <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">return</span> options
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>开发环境默认是开启 <code>exposeFilename</code> 的。</p> <p>此时组件内应该直接取 <code>this.$options.__file</code>，内容大致为 <code>src/foo/bar.vue</code>。</p> <h3 id="缺点-2"><a href="#缺点-2" aria-hidden="true" class="header-anchor">#</a> 缺点</h3> <ul><li><strong>为了安全</strong>，<code>vue-loader</code> 在生产环境将 <code>__file</code> 赋值为文件名，非路径名，<a href="https://vue-loader.vuejs.org/options.html#exposefilename" target="_blank" rel="noopener noreferrer">详见文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><em>后来得知这个方法，老李就第一时间改代码，删了方案 1 中的所有附加代码，结果发现生产环境结果不一致，翻车了orz</em></p> <h2 id="方案-3-：loader-custom-block"><a href="#方案-3-：loader-custom-block" aria-hidden="true" class="header-anchor">#</a> 方案 3 ：loader + Custom Block</h2> <p>既然方案 2 不让在生产环境用，那就自己写 loader 去加上这个源码路径，这里采用了 <a href="https://vue-loader.vuejs.org/guide/custom-blocks.html" target="_blank" rel="noopener noreferrer">Custom Block<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>这个方法是慢慢调试自定义的 loader 摸索出来的，先在 vue-loader 之前加自定义的 loader A，
去注入 Custom Block 代码，再在全局加入一个针对该 Custom Block 的 loader B。</p> <p>这里将方案封装，在 chainWebpack 中调用即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* vue.config.js */</span>
<span class="token keyword">const</span> VueFilenameInjector <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./path/to/vue-filename-injector'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">chainWebpack</span><span class="token punctuation">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">VueFilenameInjector</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      propName<span class="token punctuation">:</span> <span class="token string">'__source'</span> <span class="token comment">// default</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>源码参考：<a href="https://github.com/d2-projects/d2-advance/tree/master/tools/vue-filename-injector" target="_blank" rel="noopener noreferrer">@d2-projects/d2-advance/tools/vue-filename-injector<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- extra-class"><pre class="language-text"><code>.
└── vue-filename-injector
    ├── README.md
    ├── index.js
    └── src
        ├── index.js
        └── lib
            ├── config.js
            ├── injector.js
            └── loader.js
</code></pre></div><p><code>vue-filename-injector/index.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> blockName <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib/config.js'</span><span class="token punctuation">)</span>

<span class="token comment">// for chainWebpack</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注入</span>
  config<span class="token punctuation">.</span>module
    <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'vue-filename-injector'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./lib/injector.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">'vue-loader'</span><span class="token punctuation">)</span> <span class="token comment">// 不知为何 .before() 不是预期的结果，这里就绕了一下</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 解析</span>
  config<span class="token punctuation">.</span>module
    <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">resourceQuery</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">blockType=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blockName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'vue-filename-injector-loader'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./lib/loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>vue-filename-injector/lib/config.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> defaultPropName <span class="token operator">=</span> <span class="token string">'__source'</span>
<span class="token keyword">const</span> blockName <span class="token operator">=</span> <span class="token string">'vue-filename-injector'</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  defaultPropName<span class="token punctuation">,</span>
  blockName
<span class="token punctuation">}</span>
</code></pre></div><p><code>vue-filename-injector/lib/injector.js</code>，源码部分来自 <code>vue-loader</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> blockName<span class="token punctuation">,</span> defaultPropName <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config.js'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>content <span class="token comment">/*, map, meta */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> loaderContext <span class="token operator">=</span> <span class="token keyword">this</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    rootContext<span class="token punctuation">,</span>
    resourcePath
  <span class="token punctuation">}</span> <span class="token operator">=</span> loaderContext

  <span class="token keyword">const</span> context <span class="token operator">=</span> rootContext <span class="token operator">||</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span>loaderContext<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> rawShortFilePath <span class="token operator">=</span> path
    <span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> resourcePath<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^(\.\.[\/\\])+/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> propName <span class="token operator">=</span> options<span class="token punctuation">.</span>propName <span class="token operator">||</span> defaultPropName

  content <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blockName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;
export default function (Component) {
  Component.options.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>propName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rawShortFilePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/g</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
}
&lt;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blockName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;
</span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">return</span> content
<span class="token punctuation">}</span>
</code></pre></div><p><code>vue-filename-injector/lib/loader.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> map</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> map<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="相关仓库"><a href="#相关仓库" aria-hidden="true" class="header-anchor">#</a> 相关仓库</h2> <p>可进入预览页面查看效果，在右下角有 Toggle</p> <p>https://github.com/d2-projects/d2-admin （可能还在翻车中）</p> <p>https://github.com/d2-projects/d2-advance</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>目前看来，用自定义 loader 去注入代码是最便捷的方案，不用在每个组件中手写重复的代码。
由于 vue-cli3 采用 chainWebpack，加上个人对 webpack 的理解更是不深，暂时采用方案 3。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Aysnine/better-note/edit/master/docs/note/FrontEnd/get-vue-file-source-path.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/5/2019, 10:47:25 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/FrontEnd/elementui-tree-disabled.html" class="prev">ElementUI 之 Tree 组件切换全局 disabled</a></span> <span class="next"><a href="/note/FrontEnd/mock-lose-cookies-dbg.html">如何修复 MockJS 导致请求丢 Cookies 的问题</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f578ad0c.js" defer></script><script src="/assets/js/2.1da21283.js" defer></script><script src="/assets/js/20.4e1a83a3.js" defer></script>
  </body>
</html>
